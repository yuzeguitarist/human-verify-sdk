{"version":3,"file":"wasmWorker-CRQoSDPa.js","sources":["../pow-wasm/pkg/pow_wasm.js","../src/pow/wasmWorker.ts"],"sourcesContent":["let wasm;\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nlet cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nconst MAX_SAFARI_DECODE_BYTES = 2146435072;\nlet numBytesDecoded = 0;\nfunction decodeText(ptr, len) {\n    numBytesDecoded += len;\n    if (numBytesDecoded >= MAX_SAFARI_DECODE_BYTES) {\n        cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n        cachedTextDecoder.decode();\n        numBytesDecoded = len;\n    }\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return decodeText(ptr, len);\n}\n/**\n * 获取 WASM 版本信息\n * @returns {string}\n */\nexport function get_version() {\n    let deferred1_0;\n    let deferred1_1;\n    try {\n        const ret = wasm.get_version();\n        deferred1_0 = ret[0];\n        deferred1_1 = ret[1];\n        return getStringFromWasm0(ret[0], ret[1]);\n    } finally {\n        wasm.__wbindgen_free(deferred1_0, deferred1_1, 1);\n    }\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nconst cachedTextEncoder = new TextEncoder();\n\nif (!('encodeInto' in cachedTextEncoder)) {\n    cachedTextEncoder.encodeInto = function (arg, view) {\n        const buf = cachedTextEncoder.encode(arg);\n        view.set(buf);\n        return {\n            read: arg.length,\n            written: buf.length\n        };\n    }\n}\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = cachedTextEncoder.encodeInto(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n/**\n * SHA-256 哈希（返回十六进制字符串）\n * @param {string} input\n * @returns {string}\n */\nexport function sha256(input) {\n    let deferred2_0;\n    let deferred2_1;\n    try {\n        const ptr0 = passStringToWasm0(input, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.sha256(ptr0, len0);\n        deferred2_0 = ret[0];\n        deferred2_1 = ret[1];\n        return getStringFromWasm0(ret[0], ret[1]);\n    } finally {\n        wasm.__wbindgen_free(deferred2_0, deferred2_1, 1);\n    }\n}\n\n/**\n * 单线程完整求解（用于简单场景）\n * @param {string} challenge\n * @param {number} difficulty\n * @param {number} max_iterations\n * @returns {string}\n */\nexport function solve_pow_full(challenge, difficulty, max_iterations) {\n    let deferred2_0;\n    let deferred2_1;\n    try {\n        const ptr0 = passStringToWasm0(challenge, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.solve_pow_full(ptr0, len0, difficulty, max_iterations);\n        deferred2_0 = ret[0];\n        deferred2_1 = ret[1];\n        return getStringFromWasm0(ret[0], ret[1]);\n    } finally {\n        wasm.__wbindgen_free(deferred2_0, deferred2_1, 1);\n    }\n}\n\n/**\n * PoW 求解器 - 在指定范围内搜索 nonce\n *\n * # 参数\n * - `challenge`: PoW 挑战字符串\n * - `difficulty`: 难度（需要的前导零位数，十六进制）\n * - `start_nonce`: 起始 nonce\n * - `batch_size`: 每批搜索的数量\n *\n * # 返回\n * - 找到的 nonce（十六进制字符串），如果没找到返回空字符串\n * @param {string} challenge\n * @param {number} difficulty\n * @param {number} start_nonce\n * @param {number} batch_size\n * @returns {string}\n */\nexport function solve_pow_batch(challenge, difficulty, start_nonce, batch_size) {\n    let deferred2_0;\n    let deferred2_1;\n    try {\n        const ptr0 = passStringToWasm0(challenge, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.solve_pow_batch(ptr0, len0, difficulty, start_nonce, batch_size);\n        deferred2_0 = ret[0];\n        deferred2_1 = ret[1];\n        return getStringFromWasm0(ret[0], ret[1]);\n    } finally {\n        wasm.__wbindgen_free(deferred2_0, deferred2_1, 1);\n    }\n}\n\nconst EXPECTED_RESPONSE_TYPES = new Set(['basic', 'cors', 'default']);\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                const validResponse = module.ok && EXPECTED_RESPONSE_TYPES.has(module.type);\n\n                if (validResponse && module.headers.get('Content-Type') !== 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_externrefs;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n\n    return imports;\n}\n\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedUint8ArrayMemory0 = null;\n\n\n    wasm.__wbindgen_start();\n    return wasm;\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('pow_wasm_bg.wasm', import.meta.url);\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync };\nexport default __wbg_init;\n","/**\n * PoW WASM Worker\n * 使用 Rust 编译的 WebAssembly 进行高性能计算\n */\n\n// 导入 WASM 模块\nimport init, { solve_pow_batch, get_version } from '../../pow-wasm/pkg/pow_wasm.js'\n\nlet initialized = false\nlet workerId = 0\n\n// 初始化 WASM\nasync function initWasm(): Promise<boolean> {\n  if (initialized) return true\n  \n  try {\n    await init()\n    initialized = true\n    console.log(`[Worker ${workerId}] WASM 初始化成功:`, get_version())\n    return true\n  } catch (e) {\n    console.error(`[Worker ${workerId}] WASM 初始化失败:`, e)\n    return false\n  }\n}\n\n// JS 回退版本的 SHA-256\nconst K = new Uint32Array([\n  0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n  0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n  0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n  0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n  0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n  0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n  0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n  0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n])\n\nfunction sha256JS(str: string): string {\n  const utf8 = new TextEncoder().encode(str)\n  const len = utf8.length\n  const padLen = (len % 64 < 56) ? (56 - len % 64) : (120 - len % 64)\n  const totalLen = len + padLen + 8\n  const msg = new Uint8Array(totalLen)\n  msg.set(utf8)\n  msg[len] = 0x80\n  const view = new DataView(msg.buffer)\n  view.setUint32(totalLen - 4, len * 8, false)\n  \n  let h0 = 0x6a09e667, h1 = 0xbb67ae85, h2 = 0x3c6ef372, h3 = 0xa54ff53a\n  let h4 = 0x510e527f, h5 = 0x9b05688c, h6 = 0x1f83d9ab, h7 = 0x5be0cd19\n  const w = new Uint32Array(64)\n  \n  for (let i = 0; i < totalLen; i += 64) {\n    for (let j = 0; j < 16; j++) w[j] = view.getUint32(i + j * 4, false)\n    for (let j = 16; j < 64; j++) {\n      const s0 = ((w[j-15] >>> 7) | (w[j-15] << 25)) ^ ((w[j-15] >>> 18) | (w[j-15] << 14)) ^ (w[j-15] >>> 3)\n      const s1 = ((w[j-2] >>> 17) | (w[j-2] << 15)) ^ ((w[j-2] >>> 19) | (w[j-2] << 13)) ^ (w[j-2] >>> 10)\n      w[j] = (w[j-16] + s0 + w[j-7] + s1) >>> 0\n    }\n    let a = h0, b = h1, c = h2, d = h3, e = h4, f = h5, g = h6, h = h7\n    for (let j = 0; j < 64; j++) {\n      const S1 = ((e >>> 6) | (e << 26)) ^ ((e >>> 11) | (e << 21)) ^ ((e >>> 25) | (e << 7))\n      const ch = (e & f) ^ (~e & g)\n      const temp1 = (h + S1 + ch + K[j] + w[j]) >>> 0\n      const S0 = ((a >>> 2) | (a << 30)) ^ ((a >>> 13) | (a << 19)) ^ ((a >>> 22) | (a << 10))\n      const maj = (a & b) ^ (a & c) ^ (b & c)\n      const temp2 = (S0 + maj) >>> 0\n      h = g; g = f; f = e; e = (d + temp1) >>> 0\n      d = c; c = b; b = a; a = (temp1 + temp2) >>> 0\n    }\n    h0 = (h0 + a) >>> 0; h1 = (h1 + b) >>> 0; h2 = (h2 + c) >>> 0; h3 = (h3 + d) >>> 0\n    h4 = (h4 + e) >>> 0; h5 = (h5 + f) >>> 0; h6 = (h6 + g) >>> 0; h7 = (h7 + h) >>> 0\n  }\n  return [h0, h1, h2, h3, h4, h5, h6, h7].map(v => v.toString(16).padStart(8, '0')).join('')\n}\n\n// 逐位计算 leading zero bits（与后端一致）\nfunction countLeadingZeroBits(hexHash: string): number {\n  let bits = 0\n  for (const char of hexHash) {\n    const nibble = parseInt(char, 16)\n    if (nibble === 0) {\n      bits += 4\n    } else {\n      if (nibble < 8) bits += 1\n      if (nibble < 4) bits += 1\n      if (nibble < 2) bits += 1\n      break\n    }\n  }\n  return bits\n}\n\n// JS 回退 PoW 求解（按位计数，与后端一致）\nfunction solvePoWJS(challenge: string, difficulty: number, startNonce: number, batchSize: number): string {\n  for (let i = 0; i < batchSize; i++) {\n    const nonce = startNonce + i\n    const nonceHex = nonce.toString(16)\n    const hash = sha256JS(challenge + nonceHex)\n    if (countLeadingZeroBits(hash) >= difficulty) {\n      return nonceHex\n    }\n  }\n  return ''\n}\n\n// 消息处理\nself.onmessage = async (e: MessageEvent) => {\n  const { type, data } = e.data\n  \n  if (type === 'init') {\n    workerId = data.workerId\n    const hasWasm = await initWasm()\n    self.postMessage({ type: 'ready', workerId, hasWasm })\n    return\n  }\n  \n  if (type === 'solve') {\n    const { challenge, difficulty, startNonce, batchSize, taskId } = data\n    const start = performance.now()\n    \n    let nonce = ''\n    \n    if (initialized) {\n      // 使用 WASM\n      try {\n        nonce = solve_pow_batch(challenge, difficulty, startNonce, batchSize)\n      } catch (e) {\n        console.warn(`[Worker ${workerId}] WASM 执行失败，回退 JS:`, e)\n        nonce = solvePoWJS(challenge, difficulty, startNonce, batchSize)\n      }\n    } else {\n      // JS 回退\n      nonce = solvePoWJS(challenge, difficulty, startNonce, batchSize)\n    }\n    \n    self.postMessage({\n      type: 'result',\n      workerId,\n      taskId,\n      nonce,\n      found: nonce !== '',\n      elapsed: performance.now() - start,\n      searchedCount: batchSize,\n      usedWasm: initialized,\n    })\n  }\n}\n"],"names":["wasm","cachedUint8ArrayMemory0","getUint8ArrayMemory0","cachedTextDecoder","MAX_SAFARI_DECODE_BYTES","numBytesDecoded","decodeText","ptr","len","getStringFromWasm0","get_version","deferred1_0","deferred1_1","ret","WASM_VECTOR_LEN","cachedTextEncoder","arg","view","buf","passStringToWasm0","malloc","realloc","mem","offset","code","solve_pow_batch","challenge","difficulty","start_nonce","batch_size","deferred2_0","deferred2_1","ptr0","len0","EXPECTED_RESPONSE_TYPES","__wbg_load","module","imports","e","bytes","instance","__wbg_get_imports","table","__wbg_finalize_init","__wbg_init","module_or_path","initialized","workerId","initWasm","init","K","sha256JS","str","utf8","padLen","totalLen","msg","h0","h1","h2","h3","h4","h5","h6","h7","w","i","j","s0","s1","a","b","c","d","f","g","h","S1","ch","temp1","S0","maj","temp2","v","countLeadingZeroBits","hexHash","bits","char","nibble","solvePoWJS","startNonce","batchSize","nonceHex","hash","type","data","hasWasm","taskId","start","nonce"],"mappings":"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"}