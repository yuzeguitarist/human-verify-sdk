(async()=>{let _=!1,d=0,U=null;function L(r){const t=r||typeof self<"u"&&self.HV_BASE_PATH||"";return`${t?t.endsWith("/")?t:t+"/":""}pow_wasm_bg.wasm`}async function x(r){if(_)return!0;try{const t=await import("./pow_wasm-CWic9xMP.js");U=t;const n=L(r);return console.log(`[Worker ${d}] 加载WASM: ${n}`),await t.default(n),_=!0,console.log(`[Worker ${d}] WASM 初始化成功:`,t.get_version()),!0}catch(t){return console.error(`[Worker ${d}] WASM 初始化失败:`,t),!1}}const E=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]);function T(r){const t=new TextEncoder().encode(r),n=t.length,s=n%64<56?56-n%64:120-n%64,a=n+s+8,u=new Uint8Array(a);u.set(t),u[n]=128;const l=new DataView(u.buffer);l.setUint32(a-4,n*8,!1);let h=0x6a09e667,w=0xbb67ae85,f=0x3c6ef372,m=0xa54ff53a,W=0x510e527f,y=0x9b05688c,b=0x1f83d9ab,A=0x5be0cd19;const o=new Uint32Array(64);for(let p=0;p<a;p+=64){for(let e=0;e<16;e++)o[e]=l.getUint32(p+e*4,!1);for(let e=16;e<64;e++){const j=(o[e-15]>>>7|o[e-15]<<25)^(o[e-15]>>>18|o[e-15]<<14)^o[e-15]>>>3,v=(o[e-2]>>>17|o[e-2]<<15)^(o[e-2]>>>19|o[e-2]<<13)^o[e-2]>>>10;o[e]=o[e-16]+j+o[e-7]+v>>>0}let c=h,g=w,S=f,P=m,i=W,k=y,M=b,$=A;for(let e=0;e<64;e++){const j=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),v=i&k^~i&M,z=$+j+v+E[e]+o[e]>>>0,I=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),J=c&g^c&S^g&S,H=I+J>>>0;$=M,M=k,k=i,i=P+z>>>0,P=S,S=g,g=c,c=z+H>>>0}h=h+c>>>0,w=w+g>>>0,f=f+S>>>0,m=m+P>>>0,W=W+i>>>0,y=y+k>>>0,b=b+M>>>0,A=A+$>>>0}return[h,w,f,m,W,y,b,A].map(p=>p.toString(16).padStart(8,"0")).join("")}function V(r){let t=0;for(const n of r){const s=parseInt(n,16);if(s===0)t+=4;else{s<8&&(t+=1),s<4&&(t+=1),s<2&&(t+=1);break}}return t}function B(r,t,n,s){for(let a=0;a<s;a++){const l=(n+a).toString(16),h=T(r+l);if(V(h)>=t)return l}return""}self.onmessage=async r=>{const{type:t,data:n}=r.data;if(t==="init"){d=n.workerId;const s=n.basePath,a=await x(s);self.postMessage({type:"ready",workerId:d,hasWasm:a});return}if(t==="solve"){const{challenge:s,difficulty:a,startNonce:u,batchSize:l,taskId:h}=n,w=performance.now();let f="";if(_&&U)try{f=U.solve_pow_batch(s,a,u,l)}catch(m){console.warn(`[Worker ${d}] WASM 执行失败,回退 JS:`,m),f=B(s,a,u,l)}else f=B(s,a,u,l);self.postMessage({type:"result",workerId:d,taskId:h,nonce:f,found:f!=="",elapsed:performance.now()-w,searchedCount:l,usedWasm:_})}}})();